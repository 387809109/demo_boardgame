# 桌游集成客户端 - 产品需求文档（PRD）

## 1. 产品概述

### 1.1 产品定位
一个面向单机和局域网联机的桌游客户端平台，为玩家提供自动化规则结算、游戏管理和多人协作功能。

### 1.2 目标用户
- 桌游爱好者（单机玩家）
- 家庭/朋友局域网聚会玩家
- 需要规则辅助的新手玩家
- 桌游俱乐部和线下店
- 需要测试/演示的开发者和主播

### 1.3 核心价值
- **规则自动化**：客户端自动处理复杂规则计算和结算
- **降低门槛**：新手玩家无需完全掌握规则即可开始游戏
- **极简联机**：直连IP地址，即开即玩，无需注册登录
- **持续扩展**：支持不断添加新的桌游品种
- **轻量化**：无用户数据收集，所有设置保存在本地

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 游戏大厅
- **游戏列表**：展示所有已集成的桌游
  - 游戏名称、图标、支持人数
  - 游戏难度、预计时长
  - 游戏简介和规则说明
- **游戏筛选**：按类型、人数、难度筛选
- **搜索功能**：快速查找游戏

#### 2.1.2 游戏模式
- **单机模式**
  - 本地多人轮流操作
  - AI对手（后期功能）
- **局域网联机模式**
  - **创建主机**：选择游戏和参数，生成主机
  - **加入游戏**：输入主机IP地址直接连接
  - 显示本机IP地址，方便分享
- **多开支持**
  - 允许用户在同一台电脑上多开客户端
  - 支持单人控制多个角色（单人多控）
  - 每个客户端实例独立运行，可连接到同一主机
  - 适用场景：测试、演示、单人体验多角色游戏

#### 2.1.3 主机管理
- **创建主机**
  - 选择游戏
  - 设置玩家数量（2-8人）
  - 游戏参数配置（如难度、规则变体等）
  - 显示本机IP地址
- **等待大厅**
  - 当前连接的玩家列表（显示玩家临时昵称）
  - 主机控制（开始游戏、踢出玩家）
  - 简单的文字聊天（可选）
- **加入游戏**
  - 输入IP地址
  - 输入临时昵称
  - 连接到主机

#### 2.1.4 游戏进行
- **游戏界面**
  - 游戏状态展示
  - 玩家信息面板
  - 操作区域
  - 当前回合历史记录
- **规则引擎**
  - 自动验证操作合法性
  - 自动计算资源/分数
  - 自动触发规则效果
  - 回合管理
- **辅助功能**
  - 规则提示
  - 操作历史（当前局）

#### 2.1.5 游戏结束
- **结算界面**
  - 最终排名
  - 详细得分
  - 游戏统计数据
- 返回主菜单（不保存任何数据）

### 2.2 辅助功能

#### 2.2.1 本地设置（保存在本地）
- **图形设置**
  - 分辨率选择
  - 全屏/窗口模式
  - 画质选项
- **音频设置**
  - 音效音量
  - 音乐音量
  - 静音选项
- **游戏设置**
  - 界面语言（中文/英文）
  - 默认昵称（联机时使用）

#### 2.2.2 规则查看
- 游戏规则文档（内置）
- 图文教程
- 视频教程链接（跳转外部）

## 3. 技术需求

### 3.1 技术架构
- **前端技术栈**：
  - **HTML5 + CSS3 + JavaScript**（原生Web技术，轻量化）
  - **可选构建工具**：Vite（快速开发和打包）
  - **运行环境**：现代浏览器（Chrome 91+, Safari 16.4+, Edge 91+）
  - **部署方式**：
    - 本地HTML文件直接打开（单机模式）
    - 本地HTTP服务器（联机模式，如 http-server, Live Server）
    - 可选Node.js服务器支持（用于WebSocket连接）
- **后端架构**：
  - 单机模式：纯前端JavaScript规则引擎
  - 联机模式：主机-客户端架构（Host-Client）
    - 主机：Node.js WebSocket服务器或浏览器WebRTC
    - 客户端：浏览器WebSocket客户端
- **数据存储**：
  - **localStorage** / **IndexedDB**（浏览器本地存储）
  - 仅保存客户端设置（分辨率、音量、默认昵称等）
  - 不保存任何用户数据或游戏历史
  - 支持导入/导出配置（JSON格式）
- **多开支持**：
  - 浏览器多标签页天然支持多实例
  - 每个标签页独立运行，可连接到同一主机
  - 使用不同的 sessionStorage 隔离会话状态
  - 无需额外的进程管理或端口检测

### 3.2 网络架构
- **极简联机模式**：
  - **方案一：WebSocket（推荐）**
    - 主机运行轻量Node.js WebSocket服务器
    - 客户端通过 `ws://[IP]:7777` 连接
    - 双向实时通信，低延迟
  - **方案二：WebRTC（P2P，无需服务器）**
    - 通过公共信令服务器交换连接信息
    - 建立浏览器间P2P连接
    - 适合无法运行服务器的场景
  - **数据同步**：
    - 主机负责游戏状态管理和规则计算
    - 客户端仅发送操作指令，接收游戏状态
    - JSON格式消息传输

### 3.3 扩展性设计
- **模块化架构**（参考无名杀项目结构）：
  - `/game` - 游戏机制核心引擎
  - `/games` - 各个桌游独立模块（UNO、狼人杀等）
  - `/layout` - UI布局组件
  - `/theme` - 视觉主题系统
  - `/extension` - 扩展/插件系统
- **规则引擎**：
  - 通用规则验证框架（JavaScript类）
  - 游戏特定规则通过配置文件（JSON）定义
  - 动态加载游戏模块
- **热加载支持**：
  - 开发模式使用Vite HMR（热模块替换）
  - 生产模式通过动态 `import()` 加载游戏模块

### 3.4 本地数据存储
- **存储方式**：浏览器本地存储API
  - **localStorage**：持久化设置（音量、语言、昵称等）
  - **sessionStorage**：临时会话数据（当前游戏状态、连接信息）
  - **IndexedDB**：大型资源缓存（可选，用于离线资源）
- **数据结构**：

  ```json
  {
    "graphics": {
      "resolution": "1920x1080",
      "fullscreen": true,
      "quality": "high"
    },
    "audio": {
      "master": 80,
      "sfx": 70,
      "music": 50
    },
    "game": {
      "language": "zh-CN",
      "defaultNickname": "玩家1"
    }
  }
  ```

- **导入/导出功能**：
  - 支持导出配置为JSON文件
  - 支持从JSON文件导入配置
  - 便于迁移到不同浏览器或设备

## 4. 初期游戏品种规划

### 4.1 Phase 1（MVP阶段）
选择1-2个规则相对简单的经典桌游：
- **狼人杀**：逻辑简单，测试多人联机
- **UNO**：规则清晰，适合验证规则引擎

### 4.2 Phase 2（扩展阶段）
增加中等复杂度游戏：
- **卡坦岛**
- **卡卡颂**
- **矮人矿坑**

### 4.3 Phase 3（进阶阶段）
支持复杂策略游戏：
- **璀璨宝石**
- **七大奇迹**
- **农家乐**

## 5. 用户界面需求

### 5.1 设计原则
- **简洁直观**：降低学习成本
- **信息清晰**：重要信息突出显示
- **响应流畅**：操作反馈及时
- **视觉友好**：色彩搭配舒适

### 5.2 主要界面
1. **启动界面**：Logo + 进入按钮
2. **主菜单**：游戏大厅、设置
3. **游戏大厅**：游戏卡片列表
4. **模式选择**：单机/创建主机/加入游戏
5. **创建主机界面**：
   - 游戏参数设置
   - 显示本机IP地址
   - 等待玩家加入
6. **加入游戏界面**：
   - 输入IP地址
   - 输入临时昵称
   - 连接按钮
7. **等待大厅**：玩家列表、简单聊天
8. **游戏界面**：根据具体游戏设计
9. **设置界面**：图形、音频、语言设置

## 6. 非功能需求

### 6.1 性能需求
- **页面加载**：
  - 首次加载：< 3秒
  - 后续加载：< 1秒（利用浏览器缓存）
- **运行性能**：
  - 操作响应：< 100ms
  - 动画帧率：60 FPS
  - 内存占用：< 150MB per标签页
- **网络性能**：
  - 局域网延迟：< 50ms
  - 网络带宽要求：< 50KB/s per client
  - 最大支持玩家数：8人
- **多开性能**：
  - 支持同一浏览器同时打开至少8个标签页实例
  - 每个标签页独立运行，互不干扰
  - 总内存占用：< 1GB（8个标签页）

### 6.2 兼容性
- **浏览器要求**：
  - Chrome/Edge 91+ （推荐）
  - Safari 16.4+
  - Firefox 90+ （部分功能可能受限）
  - 不支持IE浏览器
- **必需浏览器特性**：
  - ES6+ JavaScript支持
  - WebSocket或WebRTC支持（联机模式）
  - localStorage支持
  - CSS Grid和Flexbox支持
- **屏幕分辨率**：最小 1280x720
- **操作系统**：跨平台（任何支持现代浏览器的系统）

### 6.3 稳定性
- 网络异常提示（连接失败、断线等）
- 异常情况错误提示
- 主机断线时游戏结束（不支持主机迁移）

## 7. 开发路线图

### Phase 1（MVP - 2个月）
- ✅ 核心框架搭建
- ✅ 单机模式实现
- ✅ 集成1个简单游戏（UNO）
- ✅ 基础UI完成

### Phase 2（联机功能 - 1个月）
- ✅ 主机-客户端架构实现
- ✅ IP直连功能
- ✅ 简单等待大厅
- ✅ 集成第2个游戏（狼人杀）

### Phase 3（扩展期 - 持续）
- 每月新增1-2个游戏
- 根据反馈优化
- 添加高级功能（AI对手等）

## 8. 成功指标

### 8.1 技术指标
- 规则引擎准确率：99.9%+
- 客户端稳定性：无崩溃运行2小时+
- 网络连接成功率：95%+（局域网环境）
- 局域网同步延迟：< 50ms

### 8.2 用户体验指标
- 联机设置时间：< 1分钟（从创建主机到开始游戏）
- 规则查阅便捷性
- 界面易用性
- 社区反馈评分

## 9. 风险与挑战

### 9.1 技术风险
- 复杂游戏规则实现难度高
- 网络同步一致性问题（特别是主机断线）
- 跨平台兼容性问题
- NAT穿透问题（不同网络环境下的IP连接）

### 9.2 缓解措施
- 从简单游戏开始迭代
- 采用主机权威模式，简化同步逻辑
- 选择成熟跨平台框架
- 提供网络配置指南（端口转发、防火墙设置等）
- 提供VPN/Hamachi等解决方案的使用说明

## 10. 附录

### 10.1 术语表
- **规则引擎**：自动处理游戏规则的核心系统
- **主机-客户端架构**：一个玩家作为主机负责游戏逻辑，其他玩家作为客户端连接
- **主机权威**：所有游戏状态由主机计算和管理，客户端仅发送操作
- **IP直连**：通过输入IP地址直接连接到主机，无需中央服务器

### 10.2 网络连接说明
- **同一局域网**：直接使用内网IP（如 192.168.x.x）
- **不同网络**：需要端口转发或使用VPN工具（如Hamachi、Radmin VPN）
- **防火墙设置**：需要允许客户端通过防火墙（默认端口：7777）

### 10.3 参考资料
- BoardGameGeek（桌游规则参考）
- 类似产品：Tabletop Simulator, Board Game Arena
