# 警长机制 (Captain Mechanism)

## 概述

**警长 (Captain)** 并不是一个固定的角色身份，而是狼人杀中的一个**公共头衔/机制**。任何阵营、任何身份的玩家都可以通过竞选成为警长。警长主要在白天投票阶段拥有更高的权重和影响力。

## 核心功能

### 1. 投票权重加成

警长在白天公投时拥有额外的投票权重。常见规则有：

| 规则类型 | 投票权重 |
|---------|---------|
| 标准规则 | 警长一票算 **1.5票** |
| 强势规则 | 警长一票算 **2票** |
| 特殊房规 | 警长拥有决定平票的权力 |

**默认实现建议**: 使用标准规则（1.5倍权重）

### 2. 发言顺序控制（可选规则）

在一些变体规则中，警长可以决定白天讨论阶段的发言顺序：

- **方式一**: 指定第一个发言者，之后按固定顺序（顺时针/逆时针）
- **方式二**: 完全自定义所有玩家的发言顺序
- **方式三**: 每轮动态指定下一位发言者

**默认实现建议**: 暂不实现此功能，仅保留投票权重加成

## 竞选流程

通常在**第一天白天阶段**进行警长竞选：

### 标准流程

1. **上警阶段**
   - 所有玩家选择是否参与竞选（上警/不上警）

2. **竞选发言**
   - 所有上警玩家依次发言拉票

3. **全体投票**
   - 所有玩家对上警者投票
   - 得票最多者成为警长

4. **平票处理**
   - 平票玩家进行二次发言
   - 再次投票决定
   - 若仍平票：警长空缺或随机决定（由房规决定）

5. **退水机制**
   - 上警玩家可在竞选过程中退出（"退水"）

## 警长死亡处理

当警长出局时（无论白天被投票或夜晚被击杀），有两种选择：

### 1. 移交警徽（传警徽/警徽流）

- 警长指定一名存活玩家继承警长身份
- 该玩家立即成为新警长，享有警长权利

### 2. 撕警徽

- 警长选择不传递警徽
- 警长身份消失，游戏中不再有警长

| 死亡方式 | 是否能传警徽 |
|---------|-------------|
| 白天被投票出局 | ✅ 可以 |
| 夜晚被狼人击杀 | ✅ 可以 |
| 被女巫毒杀 | ✅ 可以（多数规则） |
| 突然死亡/弃权 | ⚠️ 视房规而定 |

## 战略意义

### 对好人阵营
- 若预言家或神职当上警长：可稳定带队，提高投票效率
- 警徽流可用于传递信息（例如预言家传警徽给查验结果为好人的玩家）

### 对狼人阵营
- 若狼人当上警长：可操控投票方向，带偏节奏
- 击杀警长后可通过警徽流走向推测其真实身份

**警长位通常是开局最关键的争夺点之一。**

## 实现优先级

警长机制属于**扩展功能**，建议实现优先级：

1. **P1阶段**: 暂不实现，专注核心角色开发
2. **P2阶段**: 实现基础警长竞选和投票权重加成
3. **P3阶段**: 可选实现发言顺序控制等高级功能

## 技术实现要点

### 游戏状态字段
```javascript
{
  captain: {
    playerId: null,        // 当前警长玩家ID
    voteWeight: 1.5,       // 投票权重倍数
    isElectionPhase: false // 是否处于警长竞选阶段
  }
}
```

### 关键操作类型
- `CAPTAIN_REGISTER` - 上警（参与竞选）
- `CAPTAIN_WITHDRAW` - 退水（退出竞选）
- `CAPTAIN_VOTE` - 投票选举警长
- `CAPTAIN_TRANSFER` - 传警徽
- `CAPTAIN_TEAR` - 撕警徽

### 投票计算逻辑
```javascript
// 计算有效票数时考虑警长权重
function calculateVotes(votes, captainId, voteWeight) {
  const voteCounts = {};
  for (const [voterId, targetId] of Object.entries(votes)) {
    const weight = voterId === captainId ? voteWeight : 1;
    voteCounts[targetId] = (voteCounts[targetId] || 0) + weight;
  }
  return voteCounts;
}
```

## 参考资料

本文档基于标准狼人杀警长机制编写，主要参考：
- 线下面杀常见规则
- 狼人杀官方规则手册
- 主流线上狼人杀平台（狼人杀官方、天天狼人杀等）

---

**最后更新**: 2026-02-15
**状态**: 📝 规划中（未实装）
