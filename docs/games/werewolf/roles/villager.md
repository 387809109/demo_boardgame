# 村民 (Villager)

## 1. 角色基本信息

| 属性 | 值 |
|------|-----|
| **角色 ID** | `villager` |
| **中文名称** | 村民 |
| **英文名称** | Villager |
| **阵营** | `village` (好人阵营) |
| **优先级** | `P0` (基础角色) |
| **夜晚行动** | 无 |
| **胜利条件** | 跟随村民阵营：消灭所有狼人（优先级 4） |
| **行动时机** | 仅白天讨论与投票阶段 |

---

## 2. 核心规则

### 2.1 基本功能

- **无特殊能力**：村民是最基础的角色，没有任何夜晚行动或主动技能
- **白天讨论**：参与白天的自由讨论阶段，通过发言推理狼人身份
- **白天投票**：参与白天的投票阶段，投票放逐嫌疑玩家
- **被动角色**：夜晚处于等待状态，无法执行任何操作

### 2.2 角色定位

- **基线角色**：村民是所有好人阵营角色的基准，其他村民阵营角色在村民基础上增加特殊能力
- **信息劣势**：村民无法像预言家那样获取查验信息，只能通过逻辑推理判断
- **数量优势**：在标准配置中村民通常是人数最多的角色，构成好人阵营的票数基础
- **可被替代**：村民可被任何夜晚行动（狼刀、毒药等）击杀，无任何抵抗机制

---

## 3. 可选规则设定

村民没有任何可配置的规则选项。

村民的行为完全由游戏核心机制（白天讨论、投票、夜晚结算）控制，不需要额外的配置项。

---

## 4. 夜晚行动优先级分析

根据 `RULES.md` 的夜晚行动优先级表：

| 优先级 | 角色 | 操作 |
|--------|------|------|
| 7 | Doctor / Bodyguard / Guardian Angel | 保护 |
| 8 | Werewolf | 击杀 |
| 10 | Witch | 救人/毒杀 |

### 村民的被动地位

村民不参与夜晚行动优先级结算。夜晚阶段村民处于完全被动状态：

1. **无行动提交**：村民在夜晚不提交任何 action，系统自动跳过村民的行动阶段
2. **仅作为目标**：村民只能作为其他角色夜晚行动的目标（被狼刀、被毒、被守护、被查验等）
3. **等待天亮**：村民在夜晚 UI 中显示等待提示，直到白天阶段开始

---

## 5. 与现有角色的交互

### 5.1 村民 vs 狼人（Werewolf）

| 场景 | 结果 |
|------|------|
| 狼人击杀村民 | 村民**死亡** |
| 狼人未选择村民 | 村民**存活**，无任何影响 |

村民是狼人最常见的击杀目标之一，因为村民没有特殊能力，击杀村民的"损失"相对较小。

---

### 5.2 村民 vs 预言家（Seer）

| 场景 | 结果 |
|------|------|
| 预言家查验村民 | 查验结果为**好人** (`village`) |

预言家查验村民可以确认其身份，帮助好人阵营缩小狼人范围。

---

### 5.3 村民 vs 医生（Doctor）

| 场景 | 结果 |
|------|------|
| 医生保护村民，狼人击杀村民 | 村民**存活** |
| 医生保护村民，村民未被攻击 | 无效果（保护浪费） |

---

### 5.4 村民 vs 守卫（Bodyguard）

| 场景 | 结果 |
|------|------|
| 守卫守护村民，狼人击杀村民 | 村民**存活** |
| 守卫守护村民，女巫毒杀村民 | 村民**死亡**（守卫无法阻止毒药） |

---

### 5.5 村民 vs 女巫（Witch）

| 场景 | 结果 |
|------|------|
| 村民被狼刀，女巫使用解药 | 村民**存活** |
| 女巫对村民使用毒药 | 村民**死亡** |
| 村民被狼刀 + 守卫守护，女巫看到无人死亡 | 村民**存活**，女巫可保留解药 |

---

### 5.6 村民 vs 猎人（Hunter）

| 场景 | 结果 |
|------|------|
| 猎人开枪射杀村民 | 村民**死亡**（猎人误杀好人） |
| 村民白天投票处决猎人 | 猎人死亡并触发开枪技能 |

---

## 6. Edge Cases（易错情境与正确结算）

### 6.1 村民同一夜晚被多种方式攻击

| 攻击组合 | 结果 |
|----------|------|
| 狼刀 + 女巫毒药 | 村民死亡（双重致死，死因记录以狼刀为主） |
| 狼刀 + 守卫守护 | 村民存活（守卫阻止了狼刀） |
| 狼刀 + 守卫守护 + 女巫毒药 | 村民死亡（守卫只阻止狼刀，毒药仍生效） |
| 狼刀 + 医生保护 + 女巫毒药 | 村民死亡（医生只阻止狼刀，毒药仍生效） |

---

### 6.2 所有村民死亡

| 场景 | 结果 |
|------|------|
| 所有 `villager` 角色死亡，但仍有其他好人角色（预言家、女巫等）存活 | 游戏**继续**（胜利条件基于阵营存活，非特定角色） |
| 所有好人阵营角色死亡（包括村民） | 狼人阵营**胜利** |

**重要**：胜利判定基于阵营（`village` vs `werewolf`），不单独判定村民角色是否全灭。

---

### 6.3 村民作为最后一名好人阵营成员

| 场景 | 结果 |
|------|------|
| 场上仅剩 1 名村民 + N 名狼人 | 狼人阵营**胜利**（wolves >= villagers） |
| 场上仅剩 1 名村民 + 1 名狼人 | 狼人阵营**胜利**（wolves >= villagers） |
| 场上仅剩 2 名村民 + 1 名狼人 | 游戏**继续** |

---

### 6.4 村民白天被投票处决

| 场景 | 结果 |
|------|------|
| 村民被投票处决 | 村民死亡，公布身份（根据配置），无任何触发效果 |
| 村民被处决后的胜利检查 | 重新计算阵营人数，判断是否满足胜负条件 |

**与猎人对比**：猎人被处决会触发开枪，村民被处决无任何被动效果。

---

### 6.5 村民投票平票

| 场景 | 结果 |
|------|------|
| 白天投票平票，村民参与平票 | 按平票规则处理（PK 发言或无人出局，取决于配置） |
| 村民弃票 | 合法操作，不计入任何人的票数 |

---

### 6.6 村民被狼刀但被多重保护

| 保护来源 | 结果 |
|----------|------|
| 守卫守护 | 村民存活 |
| 医生保护 | 村民存活 |
| 女巫解药 | 村民存活 |
| 守卫 + 女巫（`guardWitchInteraction = "coexist"`） | 村民存活 |
| 守卫 + 女巫（`guardWitchInteraction = "conflict"`） | 村民**死亡**（守药同死） |

---

### 6.7 村民角色分配数量

| 场景 | 处理 |
|------|------|
| 配置中村民数量为 0 | 合法（全部为特殊角色的高级配置） |
| 配置中村民数量过多（超过总人数限制） | 配置验证失败 |
| 配置中好人阵营全部为村民（无特殊角色） | 合法但不推荐（好人阵营信息严重不足） |

---

## 7. 测试场景清单

### 7.1 角色初始化测试（4 个用例）

1. 村民角色正确分配，`roleId` 为 `villager`，`team` 为 `village`
2. 村民角色无夜晚行动注册（`roleHasNightAction` 返回 `false`）
3. 村民角色在角色列表中正确显示名称和阵营
4. 多名村民可同时存在于同一局游戏中

---

### 7.2 夜晚阶段测试（5 个用例）

5. 村民夜晚无操作面板，显示等待提示
6. 村民不提交夜晚行动，系统自动跳过
7. 夜晚阶段村民无法发送任何 action 类型的消息
8. 村民被狼刀后正确标记为死亡
9. 村民被女巫毒药后正确标记为死亡

---

### 7.3 白天阶段测试（6 个用例）

10. 村民可以在讨论阶段正常发言
11. 村民可以在投票阶段正常投票
12. 村民可以选择弃票
13. 村民被投票处决后正确标记为死亡
14. 村民被处决后无任何被动技能触发
15. 村民死亡后无法再参与讨论和投票

---

### 7.4 被保护测试（6 个用例）

16. 村民被守卫守护，狼刀未命中 → 村民存活
17. 村民被医生保护，狼刀未命中 → 村民存活
18. 村民被女巫解药救活 → 村民存活
19. 村民被守卫守护 + 女巫毒药 → 村民死亡（毒药无视守卫）
20. 村民被守卫守护 + 女巫解药（`guardWitchInteraction = "coexist"`）→ 村民存活
21. 村民被守卫守护 + 女巫解药（`guardWitchInteraction = "conflict"`）→ 村民死亡

---

### 7.5 与预言家交互测试（3 个用例）

22. 预言家查验村民 → 结果为好人 (`village`)
23. 预言家查验村民后信息正确记录在查验历史中
24. 多名村民分别被查验，结果均为好人

---

### 7.6 胜负判定测试（5 个用例）

25. 所有狼人被消灭，村民存活 → 好人阵营胜利
26. 狼人数量 >= 好人数量（含村民）→ 狼人阵营胜利
27. 所有村民死亡但仍有其他好人角色存活 → 游戏继续
28. 仅剩 1 名村民 + 1 名狼人 → 狼人胜利
29. 仅剩 2 名村民 + 1 名狼人 → 游戏继续

---

### 7.7 Edge Cases 测试（4 个用例）

30. 村民同夜被狼刀 + 女巫毒药 → 死亡（不重复计算死亡）
31. 猎人开枪射杀村民 → 村民死亡
32. 村民在第一天（无夜晚行动）直接进入讨论投票
33. 配置中 0 个村民的极端情况 → 游戏正常运行

---

**预计测试用例总数**：33 个

---

## 8. 配置建议

村民角色无需在 `config.json` 中添加任何配置项。

村民作为 P0 基础角色，已在 `config.json` 的 `roles.p0` 中定义：

```json
{
  "roles": {
    "p0": {
      "villager": {
        "id": "villager",
        "name": "村民",
        "team": "village",
        "nightAction": null,
        "priority": null
      }
    }
  }
}
```

无需额外的 `rules` 或 `settingsSchema` 条目。

---

## 9. 实现检查清单

- [ ] 在 `config.json` 的 `roles.p0` 中确认 `villager` 角色定义存在
- [ ] 确认 `villager` 未注册任何夜晚行动（`roleHasNightAction` 返回 `false`）
- [ ] 确认 `villager` 夜晚阶段 UI 显示等待提示而非操作面板
- [ ] 确认 `villager` 可正常参与白天讨论和投票
- [ ] 确认 `villager` 被各种夜晚行动（狼刀、毒药、守护、查验）正确处理
- [ ] 确认 `villager` 死亡后正确退出游戏流程（无被动技能触发）
- [ ] 确认预言家查验 `villager` 结果为好人 (`village`)
- [ ] 确认胜负判定中 `villager` 正确计入好人阵营人数
- [ ] 在 `index.test.js` 中添加 33 个测试用例
- [ ] 手动测试验证所有 Edge Cases

---

## 10. UI 呈现与交互方式

### 选择模式

无 — 村民没有夜晚行动，不需要选择目标。

### 夜间面板内容

面板文件：`ui-panels-roles.js` → 无需专属 `renderVillagerPanel`

显示内容：

- **等待提示**：显示"天黑请闭眼，请耐心等待天亮..."
- **无操作区域**：不显示任何可交互按钮或选择器
- **倒计时**（可选）：显示当前夜晚阶段剩余时间

村民夜晚面板使用通用的"无行动角色"等待界面，不需要实现专属的渲染函数。

### 操作栏按钮

无 — 村民夜晚没有可执行的操作，不显示确认按钮。

### 徽章显示

无专属徽章。

### 可见状态字段

`_getVisibleRoleStates` 中无需为村民暴露任何字段。村民没有需要追踪的角色状态。

### 白天 UI 影响

无特殊白天 UI 变化。村民使用标准的讨论和投票界面。

---

## 11. 参考资料

- **经典狼人杀规则**：[百度百科 - 狼人杀](https://baike.baidu.com/item/狼人杀)
- **村民角色定位**：作为好人阵营基线角色，无特殊能力，依赖推理和投票
- **相关角色**：所有好人阵营角色均以村民为基础扩展（预言家、女巫、猎人、医生、守卫等）

---

**文档版本**：v1.0
**创建日期**：2026-02-22
**作者**：AI-assisted
**待审核**：✅ 请确认规则设定是否符合预期
