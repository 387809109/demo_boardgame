# 丘比特角色描述

## 角色基本信息

- **角色ID**: `cupid`
- **角色中文名**: 丘比特
- **阵营**: `village`
- **优先级建议**: `P1` (首夜特殊角色)

---

## 能力描述

### 主要能力
丘比特在**首夜**可以选择两名玩家（可以包括自己）连结为恋人。恋人双方会得知彼此身份，并在之后的每个夜晚可以私聊交流。

### 触发时机
- **仅首夜**：丘比特只在第一个夜晚行动，选择两名玩家成为恋人
- **连结后**：丘比特变为普通村民，失去特殊能力

### 能力限制
- 必须选择**两名**玩家（不能多不能少）
- 只能使用一次（首夜）
- 连结后无法更改或撤销

---

## 特殊规则

### 规则 1: 恋人殉情机制
如果恋人中的一方死亡（任何原因），另一方**立即殉情**，无论该玩家的角色能力如何（包括猎人、白痴等）。

### 规则 2: 阵营变化
- **如果恋人同属一个阵营**（两个村民或两个狼人）：保持原阵营，胜利条件不变
- **如果恋人分属不同阵营**（一狼一村）：双方**脱离原阵营**，组成独立的"恋人阵营"

### 规则 3: 恋人阵营胜利条件
恋人阵营的胜利条件：**场上只剩恋人双方存活，其他所有玩家死亡**（包括原本的队友）

### 规则 4: 恋人私聊
恋人双方在每个夜晚可以私聊，但无法进行游戏内的实质性操作（如联合击杀等），仅用于信息交流。

---

## 胜利条件

### 丘比特本人
- 丘比特在连结恋人后变为**普通村民**，跟随村民阵营的胜利条件
- 如果丘比特将自己选为恋人之一，则跟随恋人的胜利条件

### 恋人阵营（一狼一村时）
- 恋人双方必须是场上唯一存活的玩家
- 即使原本的队友全部存活，只要有非恋人的玩家存活，恋人就不能获胜

---

## 与其他角色的交互

### 与保护类角色（医生/守卫）
- 恋人可以被医生/守卫保护，免于当晚狼人击杀
- 但如果另一半恋人死亡，保护无法阻止殉情

### 与击杀类角色（狼人/女巫）
- 如果狼人恋人，仍可参与击杀投票，但如果击杀了另一半恋人，自己也会殉情
- 女巫如果毒死恋人之一，另一半立即殉情

### 与猎人
- 猎人作为恋人之一时，如果另一半死亡导致殉情，猎人**无法开枪**（殉情优先于猎人技能）
- 但如果猎人本人被击杀（非殉情），可以正常开枪

### 与白痴
- 白痴作为恋人之一时，如果另一半死亡导致殉情，白痴**无法翻牌**（殉情优先于白痴技能）
- 但如果白痴被投票处决（非殉情），可以正常翻牌

---

## 边界情况 / 特殊场景

1. **丘比特将自己选为恋人之一**
   - 允许，丘比特成为恋人后失去丘比特身份，变为"恋人村民"
   - 如果连结一狼一村（包括自己），则脱离村民阵营

2. **选择两名狼人为恋人**
   - 允许，两名狼人仍属于狼人阵营
   - 但如果一方死亡，另一方也会殉情，对狼人阵营不利

3. **恋人死亡触发时机**
   - 殉情是**即时的**，发生在死亡结算的同一时刻
   - 例如：夜晚狼人杀死恋人 A，在夜晚结算时恋人 B 也同时死亡

4. **首夜丘比特未行动**
   - 如果丘比特首夜跳过或未选择两名玩家，则**失去能力**，变为普通村民
   - 不会在后续夜晚再次获得连结机会

5. **恋人中一方被投票处决**
   - 遗言阶段结束后，另一方立即殉情
   - 如果被处决的是白痴且翻牌存活，另一半不会殉情（因为白痴未死亡）

6. **恋人阵营与第三方阵营**
   - 如果有其他第三方阵营（如连环杀手），恋人阵营与之互斥
   - 场上只能有一个第三方阵营获胜

7. **丘比特死亡后恋人关系**
   - 丘比特死亡不影响已连结的恋人关系
   - 恋人关系持续到游戏结束

---

## 配置选项（可选）

### 选项 1: 丘比特可否自恋
- **名称**: `cupidCanSelfLove`
- **类型**: `boolean`
- **默认值**: `true`
- **说明**: 是否允许丘比特将自己选为恋人之一。如果设为 false，丘比特只能选择其他两名玩家。

### 选项 2: 同阵营恋人是否脱离阵营
- **名称**: `sameSideLoversSeparate`
- **类型**: `boolean`
- **默认值**: `false`
- **说明**: 如果设为 true，即使两名恋人同属一个阵营（如两个村民），也会脱离原阵营形成独立的恋人阵营。

### 选项 3: 恋人夜间私聊
- **名称**: `loversNightChat`
- **类型**: `boolean`
- **默认值**: `true`
- **说明**: 恋人是否可以在夜间私聊。如果设为 false，恋人只知道彼此身份，但无法交流。

---

## UI 需求（首夜行动）

### 面板显示内容
- 提示："请选择两名玩家成为恋人"
- 显示所有存活玩家列表（可多选，最多 2 人）
- 如果 `cupidCanSelfLove` 为 true，列表包含丘比特自己

### 交互方式
- 点击玩家头像进行多选（最多 2 人）
- 确认按钮：只有选择了正好 2 人时才可点击
- 跳过按钮：放弃连结，变为普通村民

### 确认提示
- 选择完成后显示："你选择了 {玩家A} 和 {玩家B} 成为恋人，确认吗？"
- 确认后无法撤销

---

## 额外说明

### 夜间行动优先级
建议设为 **优先级 1**（最高优先级，首夜第一个行动），因为：
- 恋人关系的建立会影响其他玩家的决策
- 如果有盗贼（交换角色），应在盗贼之后

### 状态存储
需要在游戏状态中存储：
- `state.links.lovers: [playerId1, playerId2]` - 恋人双方的 ID
- 恋人双方的 `team` 可能需要更新为 `"lovers"`（如果一狼一村）

### 死亡触发器
需要在 `_processDeathTriggers` 中检查：
- 如果死亡的玩家是恋人之一，立即标记另一半为死亡（cause: 'lover_death'）

### 胜利条件检查
在 `checkWinConditions` 中添加：
- 如果恋人阵营存在且双方存活，检查是否只剩恋人双方
- 如果恋人阵营存在但有一方死亡，恋人阵营失败

---

## 参考资料

- [狼人杀维基 - 丘比特](https://werewolf.fandom.com/wiki/Cupid)
- 经典狼人杀规则书 - 丘比特章节
- 常见变体：有些版本中，丘比特连结后不变为普通村民，保留查看恋人状态的能力
